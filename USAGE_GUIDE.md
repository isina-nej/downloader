# ÙØ§Ø±Ø³ÛŒ: Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ø¨Ø§Øª ØªÙ„Ú¯Ø±Ø§Ù…ÛŒ

## Ù†Ø­ÙˆÙ‡ Ø§Ø³ØªÙØ§Ø¯Ù‡

### Ø´Ø±ÙˆØ¹ Ø³Ø±ÛŒØ¹

1. **Ø¯Ø§Ù†Ù„ÙˆØ¯ Ùˆ Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§**:
```bash
pip install -r requirements.txt
```

2. **ØªÙ†Ø¸ÛŒÙ… Ù…Ø­ÛŒØ·**:
```bash
cp .env.example .env
```

3. **Ø§Ø¬Ø±Ø§ÛŒ Ø±Ø¨Ø§Øª**:
```bash
python -m src.main
```

### Ø¯Ø³ØªÙˆØ±Ø§Øª Ø±Ø¨Ø§Øª

#### /start
- **ØªÙˆØ¶ÛŒØ­**: Ù¾ÛŒØ§Ù… Ø®ÙˆØ´Ø§Ù…Ø¯Ú¯ÙˆÛŒÛŒ Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
- **Ø§Ø³ØªÙØ§Ø¯Ù‡**: Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ÛŒØ¯ Ø§ÛŒÙ† Ø¯Ø³ØªÙˆØ± Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†Ø¯

#### /help
- **ØªÙˆØ¶ÛŒØ­**: Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ø§Ù…Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ø¨Ø§Øª
- **Ø´Ø§Ù…Ù„**:
  - Ù†Ø­ÙˆÙ‡ Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„
  - Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§Ù†Ø¯Ø§Ø²Ù‡
  - Ø³ÛŒØ§Ø³Øª Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
  - Ø¯Ø³ØªÙˆØ±Ø§Øª Ù…ÙˆØ¬ÙˆØ¯

#### /stats
- **ØªÙˆØ¶ÛŒØ­**: Ø¢Ù…Ø§Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ÙØ¶Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ
- **Ù†Ù…Ø§ÛŒØ´**:
  - ØªØ¹Ø¯Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ´Ø¯Ù‡
  - Ø­Ø¬Ù… Ú©Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡â€ŒØ´Ø¯Ù‡
  - ÙØ¶Ø§ÛŒ Ø¯Ø³ØªØ±Ø³â€ŒÙ¾Ø°ÛŒØ±

### Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„

1. Ú©Ø§Ø±Ø¨Ø± ÙØ§ÛŒÙ„ (Ø³Ù†Ø¯ØŒ ÙˆÛŒØ¯ÛŒÙˆØŒ ÛŒØ§ ØµÙˆØª) Ø±Ø§ Ø¨Ù‡ Ø±Ø¨Ø§Øª Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
2. Ø±Ø¨Ø§Øª Ù¾ÛŒØ§Ù… "Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´..." Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
3. ÙØ§ÛŒÙ„ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯
4. ÛŒÚ© Ø´Ù†Ø§Ø³Ù‡ Ù…Ù†Ø­ØµØ± Ø¨Ù‡ ÙØ±Ø¯ (UUID) Ø¨Ø±Ø§ÛŒ ÙØ§ÛŒÙ„ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯
5. Ø±Ø¨Ø§Øª Ù„ÛŒÙ†Ú© Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯

### Ù…Ø«Ø§Ù„ ÙˆØ§Ù‚Ø¹ÛŒ

```
Ú©Ø§Ø±Ø¨Ø±: [Ø§Ø±Ø³Ø§Ù„ ÛŒÚ© ÙØ§ÛŒÙ„ PDF 50MB]
Ø±Ø¨Ø§Øª: â³ Processing document.pdf...
      Size: 50.25 MB
      
Ø±Ø¨Ø§Øª: âœ… File Uploaded Successfully!

     ğŸ“ File: document.pdf
     ğŸ’¾ Size: 50.25 MB
     ğŸ”— Link: https://yourdomain.com/download/a1b2c3d4-e5f6-7890-abcd-ef1234567890

     The link will be available for 30 days.
```

---

# English: User Guide

## Quick Start

### Installation

1. **Install dependencies**:
```bash
pip install -r requirements.txt
```

2. **Setup environment**:
```bash
cp .env.example .env
```

3. **Run the bot**:
```bash
python -m src.main
```

### Bot Commands

#### /start
- **Description**: Shows welcome message
- **When**: Run when first starting with the bot

#### /help
- **Description**: Shows comprehensive usage guide
- **Includes**:
  - How to send files
  - Size limits
  - File retention policy
  - Available commands

#### /stats
- **Description**: Shows storage statistics
- **Displays**:
  - Total files stored
  - Total storage used
  - Available disk space

### Sending Files

1. User sends a file (document, video, or audio) to the bot
2. Bot shows "Processing..." message
3. Bot downloads file to secure server
4. Unique ID (UUID) is generated for the file
5. Bot sends download link to user

### Real Example

```
User: [Sends a 50MB PDF file]
Bot: â³ Processing document.pdf...
     Size: 50.25 MB
     
Bot: âœ… File Uploaded Successfully!

    ğŸ“ File: document.pdf
    ğŸ’¾ Size: 50.25 MB
    ğŸ”— Link: https://yourdomain.com/download/a1b2c3d4-e5f6-7890-abcd-ef1234567890

    The link will be available for 30 days.
```

## System Limits

| Limit | Value | Notes |
|-------|-------|-------|
| Max File Size | 2GB | Telegram limitation for non-premium users |
| Files Per Minute | 10 | Rate limiting per user |
| File Retention | 30 days | Auto-deleted after this period |
| Concurrent Users | 1000+ | System capacity dependent |

## Troubleshooting

### Bot not responding
- Verify bot token in `.env`
- Check bot is running: `python -m src.main`
- Review logs: `cat logs/bot.log`

### Download link not working
- Ensure link is not expired (30 days max)
- Verify web server is running
- Check `DOWNLOAD_URL_BASE` configuration

### Storage full
- Check available space: `curl http://localhost:8000/stats`
- Reduce `FILE_RETENTION_DAYS` in `.env`
- Manually delete old files from `storage/` directory

---

# ÙØ§Ø±Ø³ÛŒ: Ø¯Ø³ØªÙˆØ±Ø§Ù„Ø¹Ù…Ù„ ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù†

## Ø³Ø§Ø®ØªØ§Ø± Ù¾Ø±ÙˆÚ˜Ù‡

```
src/
â”œâ”€â”€ main.py              # Ù†Ù‚Ø·Ù‡ ÙˆØ±ÙˆØ¯ÛŒ Ø§ØµÙ„ÛŒ
â”œâ”€â”€ config.py            # Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ†Ø¸ÛŒÙ…Ø§Øª
â”œâ”€â”€ bot.py               # Ø±Ø¨Ø§Øª ØªÙ„Ú¯Ø±Ø§Ù…
â”œâ”€â”€ web.py               # Ø³Ø±ÙˆØ± ÙˆØ¨ FastAPI
â”œâ”€â”€ storage.py           # Ù…Ø¯ÛŒØ±ÛŒØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
â”œâ”€â”€ database.py          # Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³
â”œâ”€â”€ logging_config.py    # ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù„Ø§Ú¯â€ŒÚ¯Ø°Ø§Ø±ÛŒ
â””â”€â”€ rate_limiter.py      # Ù…Ø­Ø¯ÙˆØ¯â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ù†Ø±Ø® Ø¯Ø±Ø®ÙˆØ§Ø³Øª

storage/                 # Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
logs/                    # ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù„Ø§Ú¯
```

## OpenSpace Implementation

Ø§ÛŒÙ† Ù¾Ø±ÙˆÚ˜Ù‡ Ø§Ø² Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ **OpenSpace** Ø¨Ø±Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡ Ù¾ÛŒØ±ÙˆÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯:

### Ù…Ø³ØªÙ†Ø¯Ø³Ø§Ø²ÛŒ

- **[openspec/project.md](openspec/project.md)**: ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ùˆ Ù‚ÙˆØ§Ù†ÛŒÙ† Ù¾Ø±ÙˆÚ˜Ù‡
- **[openspec/prd.1.1.md](openspec/prd.1.1.md)**: Ù…Ø´Ø®ØµØ§Øª Ù…Ø­ØµÙˆÙ„
- **[openspec/specs/](openspec/specs/)**: Ù…Ø³ØªÙ†Ø¯Ø³Ø§Ø²ÛŒ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§

### Ø§ÛŒØ¬Ø§Ø¯ ØªØºÛŒÛŒØ±Ø§Øª

Ù‚Ø¨Ù„ Ø§Ø² Ú©Ø¯Ù†ÙˆÛŒØ³ÛŒ:
1. Ø¨Ø±Ø±Ø³ÛŒ `openspec/specs/` Ø¨Ø±Ø§ÛŒ Ù…Ø³ØªÙ†Ø¯Ø³Ø§Ø²ÛŒ ÙØ¹Ù„ÛŒ
2. Ø§ÛŒØ¬Ø§Ø¯ proposal.md Ø¯Ø± `openspec/changes/[change-id]/`
3. Ù†ÙˆØ´ØªÙ† design.md (Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø²)
4. ØªØ§ÛŒÛŒØ¯ proposal Ù‚Ø¨Ù„ Ø§Ø² Ø§Ø¬Ø±Ø§

### Ú©Ø¯ Ø²Ù†ÛŒ

```bash
# Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡
pip install -r requirements.txt

# Format Ú©Ø¯Ù‡Ø§
black src/

# Linting
flake8 src/

# Type checking (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
mypy src/

# ØªØ³Øªâ€ŒÙ‡Ø§ (Ø¯Ø± ØªÙˆØ³Ø¹Ù‡)
pytest
```

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Telegram Users     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TelegramBot        â”‚ â† Async file handling
â”‚  (polling)          â”‚   Rate limiting
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   Command processing
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  StorageManager     â”‚ â† UUID generation
â”‚  (streaming I/O)    â”‚   Chunk writing
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   Size validation
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Storage â”‚  â”‚   SQLite     â”‚ â† Metadata tracking
â”‚Disk    â”‚  â”‚   Database   â”‚   Owner tracking
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â–²
    â”‚ (HTTP streaming)
    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FastAPI Web Server â”‚
â”‚  /download/{id}     â”‚ â† Async responses
â”‚  /health            â”‚   Error handling
â”‚  /stats             â”‚   Cleanup triggers
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# English: Developer Guide

## Project Structure

```
src/
â”œâ”€â”€ main.py              # Main entry point
â”œâ”€â”€ config.py            # Configuration management
â”œâ”€â”€ bot.py               # Telegram bot handler
â”œâ”€â”€ web.py               # FastAPI web server
â”œâ”€â”€ storage.py           # File management
â”œâ”€â”€ database.py          # Database models
â”œâ”€â”€ logging_config.py    # Logging setup
â””â”€â”€ rate_limiter.py      # Rate limiting

storage/                 # File storage
logs/                    # Log files
```

## OpenSpace Implementation

This project follows **OpenSpace** standards:

### Documentation

- **[openspec/project.md](openspec/project.md)**: Project settings and conventions
- **[openspec/prd.1.1.md](openspec/prd.1.1.md)**: Product specifications
- **[openspec/specs/](openspec/specs/)**: Capability documentation

### Creating Changes

Before coding:
1. Check `openspec/specs/` for current documentation
2. Create proposal.md in `openspec/changes/[change-id]/`
3. Write design.md (if needed)
4. Get proposal approval before implementation

### Development

```bash
# Install dev dependencies
pip install -r requirements.txt

# Format code
black src/

# Linting
flake8 src/

# Type checking (optional)
mypy src/

# Tests (in development)
pytest
```

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Telegram Users     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TelegramBot        â”‚ â† Async file handling
â”‚  (polling)          â”‚   Rate limiting
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   Command processing
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  StorageManager     â”‚ â† UUID generation
â”‚  (streaming I/O)    â”‚   Chunk writing
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   Size validation
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Storage â”‚  â”‚   SQLite     â”‚ â† Metadata tracking
â”‚Disk    â”‚  â”‚   Database   â”‚   Owner tracking
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â–²
    â”‚ (HTTP streaming)
    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FastAPI Web Server â”‚
â”‚  /download/{id}     â”‚ â† Async responses
â”‚  /health            â”‚   Error handling
â”‚  /stats             â”‚   Cleanup triggers
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Design Decisions

1. **Async-First**: All I/O is non-blocking (async/await)
2. **Streaming**: Files never loaded fully into memory
3. **UUID-Based IDs**: Prevents brute-force attacks
4. **Rate Limiting**: Per-user sliding window
5. **Modular Design**: Clear separation of concerns
6. **SQLite**: Lightweight, file-based database
7. **Structured Logging**: JSON logs for monitoring

## Performance Optimizations

1. **Streaming Downloads**: Chunks written directly to disk
2. **Async Client**: Using httpx for concurrent requests
3. **Connection Pooling**: Reuse DB connections
4. **Index Optimization**: Database queries optimized
5. **Memory Limits**: Explicit buffer sizes (5MB chunks)
6. **Cleanup Batching**: Process multiple deletes efficiently

## Security Features

1. **UUID Randomization**: 2^122 possible IDs
2. **Token Protection**: Stored in .env only
3. **Rate Limiting**: 10 requests per minute per user
4. **Input Validation**: File size and format checks
5. **Error Masking**: No sensitive info in error messages
6. **Audit Logging**: All operations logged

## Deployment Options

### Development
```bash
python -m src.main
```

### PM2
```bash
npm install -g pm2
pm2 start "python -m src.main" --name telegram-downloader
pm2 save
```

### Systemd
```bash
sudo systemctl start telegram-downloader
sudo systemctl enable telegram-downloader
```

### Docker (Future)
```dockerfile
FROM python:3.10-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY src/ src/
CMD ["python", "-m", "src.main"]
```
